#!/bin/sh

package_name="binutils"
package_version="2.45"
package_description="Contains a linker, an assembler, and other tools for handling object files"
package_source="https://sourceware.org/pub/binutils/releases/binutils-2.45.tar.xz dee5b4267e0305a99a3c9d6131f45759"

source_dir="$package_name-$package_version"

configure() {
    cd "$source_dir" || log_error "In $package_name.build: Failed to cd to $source_dir"
    mkdir build
    cd build || return 1

    ../configure --prefix=/usr \
         --sysconfdir=/etc   \
         --enable-ld=default \
         --enable-plugins    \
         --enable-shared     \
         --disable-werror    \
         --enable-64-bit-bfd \
         --enable-new-dtags  \
         --with-system-zlib  \
         --enable-default-hash-style=gnu
}

build() {
    make tooldir=/usr
}

install_files() {
    make tooldir=/usr install

    rm -v "$DESTDIR/usr/lib/libbfd.a" \
        "$DESTDIR/usr/lib/libbfd.la" \
        "$DESTDIR/usr/lib/libctf.a" \
        "$DESTDIR/usr/lib/libctf.la" \
        "$DESTDIR/usr/lib/libctf-nobfd.a" \
        "$DESTDIR/usr/lib/libctf-nobfd.la" \
        "$DESTDIR/usr/lib/libopcodes.a" \
        "$DESTDIR/usr/lib/libopcodes.la" \
        "$DESTDIR/usr/lib/libsframe.a" \
        "$DESTDIR/usr/lib/libsframe.la"
}
